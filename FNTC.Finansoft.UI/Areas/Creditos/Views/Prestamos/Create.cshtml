@model FNTC.Finansoft.Accounting.DTO.MCreditos.ViewModelPrestamosYGarantias

@{
    Layout = "~/Views/Shared/_Layoutcreditos.cshtml";
}
<script src="~/Scripts/sweetalert.min.js"></script>
<link href="~/Content/css/sweetalert.css" rel="stylesheet" />
@{
    ViewBag.Title = "Crear Nuevo Prestamo";
    var idSolicitud = ViewBag.idSolicitud;
}


@section Styles{
    <link href="~/Content/css/jquery-ui.min.css" rel="stylesheet" />
    @*Choosen*@
    <link href="~/Content/css/chosen.css" rel="stylesheet" />

    @*fin choseen*@
    <style>
        .ui-autocomplete {
            z-index: 5000;
        }
    </style>

}
<script src="~/Scripts/Creditos/ValidacionesCrear.js"></script>

@using (Html.BeginForm("Create", "Prestamos", new { area = "Creditos" }, FormMethod.Post, new { id = "theForm" }))
{
    @Html.AntiForgeryToken()

    <!--Campos Ocultos HIDDEN hidden="hidden"-->
    <input type="text" id="ValorPeriodo" value="" name="ValorPeriodo" hidden="hidden">
    <input type="text" id="ValorSeguro" value="0" name="ValorSeguro" hidden="hidden">
    <input type="text" id="ValorSeguroPorcentaje" value="0" name="ValorSeguroPorcentaje" hidden="hidden">
    <input type="text" id="ValorPorcentajeCostoAnticipado" value="0" name="ValorPorcentajeCostoAnticipado" hidden="hidden">
    <input type="text" id="CA_Id" value="" name="CA_Id" disabled="disabled" readonly hidden="hidden">
    <input type="text" id="ValDiasInt" value="" name="ValDiasInt" readonly hidden="hidden">
    <input type="text" id="difdias" value="" name="difdias" readonly hidden="hidden">
    <input type="text" id="fechadesembolso" value="" name="fechadesembolso" readonly hidden="hidden">
    <input type="text" id="costoAdicionalEnEltiempo" value="0" name="costoAdicionalEnEltiempo" readonly hidden="hidden">
    <input type="text" id="costoAdicionalAnticipado" value="0" name="costoAdicionalAnticipado" readonly hidden="hidden">
    <input type="text" id="costoAdicionalPrimeraCuota" value="0" name="costoAdicionalPrimeraCuota" readonly hidden="hidden">
    <input type="text" id="costoAdicionalDividoEnElTiempo" value="0" name="costoAdicionalDividoEnElTiempo" readonly hidden="hidden">
    <input type="text" id="ValorPorcentajeCostoEnCadaCuota" value="0" name="ValorPorcentajeCostoEnCadaCuota" readonly hidden="hidden">

    <input type="text" id="garantia_id" value="" name="garantia_id" readonly hidden="hidden">
    <input type="text" id="codeudorovalor" value="" name="codeudorovalor" readonly hidden="hidden">
    <input type="text" id="codeudor_nit" value="" name="codeudor_nit" readonly hidden="hidden">
    <input type="text" id="nombre_codeudor" value="" name="nombre_codeudor" readonly hidden="hidden">
    <input type="text" id="mivalor" value="" name="mivalor" readonly hidden="hidden">

    <input type="text" id="auxCostoAdicionalEnEltiempo" name="auxCostoAdicionalEnEltiempo" value="" hidden="hidden" />
    <input type="text" id="auxCostoAdicionalDividoEnElTiempo" name="auxCostoAdicionalDividoEnElTiempo" value="" hidden="hidden" />
    <input type="text" id="auxValorPorcentajeCostoAnticipado" name="auxValorPorcentajeCostoAnticipado" value="" hidden="hidden" />
    <input type="text" id="auxValorPorcentajeCostoEnCadaCuota" name="auxValorPorcentajeCostoEnCadaCuota" value="" hidden="hidden" />

    <div class="row">
        <div class="col-lg-12">

            <!-- Elementos del Formulario -->
            <div class="panel panel-primary">
                <div class="panel-heading">
                    GENERAR CREDITO
                </div>

                <div class="panel-body">
                    <div class="row">
                        @Html.ValidationSummary(true)
                        <div class="panel panel-success">
                            <div class="panel-heading">
                                <h3 class="panel-title">Lineas, Destinos y Subdestinos</h3>
                            </div>

                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="control-label col-md-10">Lineas</label>
                                                <div class="col-md-10">
                                                    @Html.DropDownList("Lineas_Id", null, new { @class = "chosen-select-single" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="control-label col-md-10">
                                                </label>
                                                <div class="col-md-10">
                                                    @Html.DropDownList("Destino_Id", new SelectList(string.Empty, "Value", "Text"), "Seleccione Un Destino", new { @style = "width:250px;", @class = "form-control" })

                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="control-label col-md-10">Subdestinos</label>
                                                <div class="col-md-10">
                                                    @Html.DropDownList("Subdestino_Id", new SelectList(string.Empty, "Value", "Text"), "Seleccione Un Destino", new { @style = "width:200px;", @class = "form-control" })
                                                    @Html.ValidationMessageFor(model => model.Subdestino_Id, "", new { @style = "color:red" })
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>@*Fin Panel Body*@
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.NIT, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">
                                            @Html.TextBoxFor(model => Model.NIT, new { @id = "NIT", @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.NIT, "", new { @style = "color:red" })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.NOMBRE, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">
                                            @Html.TextBoxFor(model => Model.NOMBRE, new { @id = "NOMBRE", @class = "form-control", @readonly = true })
                                            @Html.ValidationMessageFor(model => model.NOMBRE, "", new { @style = "color:red" })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.SALARIO, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">
                                            @Html.TextBoxFor(model => Model.SALARIO, new { @id = "SALARIO", @class = "form-control", @readonly = true })
                                            @Html.ValidationMessageFor(model => model.SALARIO, "", new { @style = "color:red" })
                                        </div>
                                    </div>
                                </div>

                                @*<div class="col-lg-8">
                                        <div class="form-group">
                                            <label class="control-label col-md-10">Nombre Asosiado</label>
                                            <div class="col-md-11">

                                                <label for="nombre" class="control-label">Asociado:</label>
                                                <input type="text" id="_nombre" class="form-control" value="">
                                                <input type="text" id="salari" class="form-control" value="">

                                                @Html.ValidationMessageFor(model => model.Creditos_Id)
                                            </div>
                                        </div>
                                    </div>*@
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Pagare, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">
                                            @*@Html.TextBoxFor(model => model.Capital, new { htmlAttributes = new { @class = "form-control", rows = "3" } })*@
                                            @Html.TextBoxFor(model => Model.Pagare, new { @id = "Pagare", @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.Pagare, "", new { @style = "color:red" })

                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Capital, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">
                                            @*@Html.TextBoxFor(model => model.Capital, new { htmlAttributes = new { @class = "form-control", rows = "3" } })*@
                                            <div class="input-group col-lg-12">
                                                <label class="input-group-addon">$</label>
                                                <input type="text" id="Prestamo" required class="form-control" value="">
                                            </div>
                                            @Html.TextBoxFor(model => Model.Capital, new { @id = "Capital", @class = "form-control", @disabled = "disabled", @style = "display: none;" })
                                            @*@Html.ValidationMessageFor(model => model.Capital)*@
                                            @Html.ValidationMessageFor(model => model.Capital, "", new { @style = "color:red" })
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Interes, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">
                                            <div class="input-group col-lg-12">
                                                @Html.TextBoxFor(model => model.Interes, new { @id = "Interes", @class = "form-control" })
                                                @Html.HiddenFor(model => model.auxInteres)
                                                <label class="input-group-addon">%</label>
                                            </div>
                                            @Html.ValidationMessageFor(model => model.Interes, "", new { @style = "color:red" })
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="col-lg-4">


                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Tipo_Periodo_Id, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">

                                            @Html.DropDownList("Tipo_Periodo_Id", (SelectList)ViewBag.Tipo_Periodo_Id, "Sleccione Un Periodo", new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.Tipo_Periodo_Id, "", new { @style = "color:red" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Plazo, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">
                                            <div class="input-group col-lg-12">
                                                @Html.TextBoxFor(model => model.Plazo, new { @id = "Plazo", @class = "form-control ui-autocomplete-input", @disabled = "disabled" })
                                                <label class="input-group-addon">Meses</label>
                                            </div>
                                            @Html.ValidationMessageFor(model => model.Plazo, "", new { @style = "color:red" })
                                        </div>

                                    </div>
                                </div>
                                <div class="col-lg-4">

                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Fecha_Prestamo, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">

                                            @Html.TextBoxFor(model => model.Fecha_Prestamo, new { htmlAttributes = new { @id = "Fecha_Prestamo" }, @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.Fecha_Prestamo, "", new { @style = "color:red" })
                                            @Html.ViewBag.Mensaje
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br />
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Fecha_Primer_Pago, new { @class = "control-label col-md-10" })
                                        <div class="col-md-10">
                                            @Html.TextBoxFor(model => model.Fecha_Primer_Pago, new { @id = "FechaPrimerPago", @class = "form-control", @readonly = "true" })
                                            @Html.ValidationMessageFor(model => model.Fecha_Primer_Pago, "", new { @style = "color:red" })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-8">
                                    <div class="form-group">
                                        @Html.LabelFor(model => model.Forma_Pago_Id, new { @class = "control-label col-md-10" })
                                        <div class="col-md-11">
                                            @Html.DropDownList("Forma_Pago_Id", (SelectList)ViewBag.Forma_Pago_Id, "Seleccione Forma de Pago", new { @class = "form-control" })
                                            @Html.ValidationMessageFor(model => model.Forma_Pago_Id, "", new { @style = "color:red" })
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>

                        <br />

                        @*iNicio Costos Adicionales*@
                        <div class="panel panel-info" id="Costosx">
                            <div class="panel-heading">
                                <h3 class="panel-title">Costos Adicionales</h3>
                            </div>
                            <div class="panel-body">
                                <table id="tableCostosAdicionales" class="compact table table-bordered table-striped">
                                    <thead class="thead-inverse">
                                        <tr>
                                            <th>No.</th>
                                            <th># Cuenta</th>
                                            <th>Nombre Del Costo Adicional</th>
                                            <th>%</th>
                                            <th>Valor</th>
                                            <th>Accion</th>
                                            <th>Se Cobra Como: </th>
                                        </tr>
                                    </thead>
                                    <tbody id="bodyCostosAdicionales">
                                        <!-------------------------- LISTA DE COSTOS ADICIONALES -------------------->
                                    </tbody>
                                </table>

                            </div>
                            <div class="panel-footer">
                                <table id="tableCostosAdicionales" class="compact table table-bordered table-striped">
                                    <thead class="thead-inverse">
                                        <tr>
                                            <th>No.</th>
                                            <th># Cuenta</th>
                                            <th>Nombre Del Costo Adicional</th>
                                            <th>%</th>
                                            <th>Valor</th>
                                            <th>Se Cobra Como</th>
                                        </tr>
                                    </thead>
                                    <tbody id="CostosSeleccionados">
                                        <!-------------------------- LISTA DE COSTOS ADICIONALES -------------------->
                                    </tbody>
                                </table>


                                @*<div class="row">
                                        <label>Total de Costos Adicionales</label>
                                        <input type="text" class="form-control col-lg-6" id="costoadicionaltotal" disabled />
                                    </div>*@


                            </div>
                        </div>
                        @*Fin Costos Adicionales*@

                        @*Inicio Creaditos*@
                        <div class="panel panel-info">
                            <div class="panel-heading">
                                <h3 class="panel-title">Garantias Del Prestamo</h3>
                            </div>

                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="col-lg-4">
                                        <div class="form-group">
                                            <label>Garantia</label>
                                            <div class="input-group">
                                                @Html.DropDownList("Garantia_Id", null, new { @class = "chosen-select-single" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-lg-2">
                                        <label></label>
                                        <div class="form-group">

                                            @Html.ActionLink("Agregar", "Filtro", "Prestamos", null, new { id = "gar", @class = "glyphicon glyphicon-plus btn btn-success btn-large", data_toggle = "modal" })

                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <label>Interes Anticipado Se Cobra Como:</label>
                                        <div class="form-group">
                                            <select id="myselect" name="myselect" class="form-control">
                                                <option value="2">COSTO ADICIONAL EN EL TIEMPO (ET)</option>
                                                <option value="3">COSTO ADICIONAL PRIMERA CUOTA (CP)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-2">
                                        <label></label>
                                        <div class="form-group">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @*Modal para Garantias*@
                            <!-- Button trigger modal -->
                            @*<a href="#" class="btn btn-primary" data-toggle="modal" data-target="#myModal">Open Modal</a>*@


                            <!-- Fin Button trigger modal -->

                            <div class="panel panel-info">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Lista Garantias</h3>
                                </div>
                                <div class="panel-body">
                                    <table id="table1" class="compact table table-bordered table-striped"></table>

                                </div>
                            </div>
                        </div>
                        @*fin Creditos*@


                        <div class="form-group">
                            <div class="col-md-offset-0 col-md-2">

                                <input type="button" id="AmortizacionBtn" onclick="Amotizacion()" value=" Ver Amortización" class="btn btn-primary" data-toggle="modal" data-target="#ModalAmortizacion" />

                            </div>
                            <div class="col-md-2">

                                <input type="button" id="DataCredito" value="Descargar Formato - Autorizacion para Tratamiento de Datos" class="btn btn-light" />

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>



    <div>
        @Html.ActionLink("Regresar a la Lista", "Index")
    </div>

}


<!-- Modal Garantias Valores de Hipotecas y Codeudores -->
<div class="modal fade" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title">Garantias</h3>

            </div>
            <div class="modal-body">
                <form id="myForm" name="myForm">
                    <label class="control-label col-md-10">Ingrese el Valor de la Garantia</label>
                    @*<input type="text" id="real" name="real" required class="form-control" value="">*@
                    <div class="input-group col-lg-12">
                        <label class="input-group-addon">$</label>
                        <input type="text" id="Real_Valor" name="Real_Valor" class="form-control" value="">
                    </div>
                    <input type="text" id="PagareId" name="PagareId" required value="" readonly hidden="hidden">
                </form>

                <div style="text-align:center;display:none" id="loaderDiv">
                    <img src="~/Content/assets/img/loading.gif" width="20" /> @* //put any image in content folder*@
                </div>


            </div>
            <div class="modal-footer">

                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                <input type="reset" value="Guardar" class="btn btn-success" id="btnSubmit" />

            </div>

        </div>

    </div>

</div>

@*Codeudores*@

<div class="modal fade" id="myModal2">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <a href="#" class="close" data-dismiss="modal">&times;</a>
                <h3 class="modal-title">Garantias</h3>

            </div>
            <div class="modal-body">

                <form id="myForm2" name="myForm2">
                    <input type="text" id="PagarePer" name="PagarePer" required value="" readonly hidden="hidden">
                    @*@Html.ListBox("NIT", ViewBag.NIT as MultiSelectList, new { @class = "chosen-select-multiple" })*@
                    @Html.DropDownList("NIT", null, new { @class = "chosen-select-single", id = "codeudor" })
                </form>

                <div style="text-align:center;display:none" id="loaderDiv2">
                    <img src="~/Content/assets/img/loading.gif" width="20" /> @* //put any image in content folder*@
                </div>

            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
                <input type="reset" value="Guardar" class="btn btn-success" id="btnSubmit2" />
            </div>
        </div>
    </div>
</div>


@*Fin Modal para garantias para Hipotecas*@


@*Tabla de Artizacion*@

<div id="ModalAmortizacion" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h3 class="modal-title"><span class="fa fa-table"></span> Amortización</h3>
            </div>
            <!-- Modal content-->
            <div class="modal-body">
                <div class="table-responsive" id="imprimir">

                    <table class="table table-bordered " border="1" cellpadding="0">
                        <thead id="interess">
                            <tr>
                                <th>Fecha Actual</th>
                                <th>Fecha de prestamo</th>
                                <th>Dias Transcurridos</th>
                                <th>Valor del Interes</th>
                            </tr>
                        </thead>
                        <tbody id="interes"></tbody>

                        <thead id="capitalDescuentoss">
                            <tr>
                                <th>Valor Solicitado</th>
                                <th>Descuentos Anticipados</th>
                                <th>Total Desembolso</th>
                            </tr>
                        </thead>
                        <tbody id="capitalDescuentos"></tbody>
                    </table>

                    <table class="table table-bordered " border="1" cellpadding="0">
                        <thead id="headamorti" class="thead-inverse">
                            <tr>
                                <th>#</th>
                                <th>Calendario de Pagos</th>
                                <th>Valor Cuota</th>
                                <th>Abono Capital</th>
                                <th>Abono Interes</th>
                                <th>Saldo Capital</th>
                                <th>Valor Seguro</th>
                                @*<th>Valor Costo %</th>*@
                                <th>Administración</th>
                            </tr>
                        </thead>
                        <tbody id="TablaAmortizacion"></tbody>
                    </table>

                </div>
            </div>
            <div class="modal-footer">
                <input type="button" value="Crear Prestamo" class="btn btn-primary" id="CrearC" />
                @*<button type="button" id="imprime" onclick="imprime('imprimir')" class="btn btn-default">Imprimir</button>*@
            </div>
        </div>
    </div>

</div>

@*Fin Tabla de Artizacion*@

@*Tabla de Amortizacion Para Intereses Anticipados*@

<div id="ModalAmortizacion2" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h3 class="modal-title"><span class="fa fa-table"></span> Amortización</h3>
            </div>
            <!-- Modal content-->
            <div class="modal-body">
                <div class="table-responsive" id="imprimir">
                    <table class="table table-bordered " border="1" cellpadding="0">
                        <thead id="interess">
                            <tr>
                                <th>Fecha Actual</th>
                                <th>Fecha de prestamo</th>
                                <th>Dias Transcurridos</th>
                                <th>Valor del Interes</th>
                            </tr>
                        </thead>
                        <tbody id="interes"></tbody>
                    </table>

                    <table class="table table-bordered " border="1" cellpadding="0">
                        <thead id="headamorti" class="thead-inverse">
                            <tr>
                                <th>#</th>
                                <th>Calendario de Pagos</th>
                                <th>Valor Cuota</th>
                                <th>Abono Capital</th>
                                <th>Abono Interes</th>
                                <th>Saldo Capital</th>
                                <th>Valor Costo</th>
                            </tr>
                        </thead>
                        <tbody id="TablaAmortizacion2"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                @*<button type="button" id="imprime" onclick="imprime('imprimir')" class="btn btn-default">Imprimir</button>*@
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script src="~/Scripts/chosen.jquery.min.js"></script>
    <script src="~/Scripts/moment.js"></script>
    
    <script>
        $("#DataCredito").click(function () {
            
            location.href = '@Url.Action("Imagen", "Prestamos")';
    });

    </script>

    <script>
        $("#DataCredito").click(function () {

            location.href = '@Url.Action("Imagen", "Prestamos")';
    });

    </script> 

    <script>
        $(document).ready(function () {
            $.ajax({

                url: '@Url.Action("GetFechaActual","Prestamos")',
                method: 'GET',
            }).done(function (data) {

                var FechaConvertida = moment(data).format("DD/MM/YYYY");
                $('#Fecha_Prestamo').val(FechaConvertida);

            });
        });
    </script><!--Get Fecha Actual-->

    <script type="text/javascript">
        $(document).ready(function () {
            $(".chosen-select-single").chosen();
            $(".chosen-select-multiple").chosen();

        });
    </script><!--Script Libreria chosen-->

    <script>
        $(function () {
            $("#gar").click(function () {
                var auxGarantia = $('#Garantia_Id').val();
                $('#Real_Valor').attr('readonly', false);
                $("#Real_Valor").val("");
                $.ajax({
                    url: this.href,
                    type: 'POST',
                    data: { input: $('#Garantia_Id').val() },
                    success: function (result) {
                        var x = result.name;
                        if (x == 0) {
                            $("#myModal2").modal("toggle");
                            $("#codeudorovalor").val("cod");
                        }
                        else {
                            if (auxGarantia == "4") {
                                $("#Real_Valor").val("1");
                                $('#Real_Valor').attr('readonly', true);
                                $("#btnSubmit").click(function () {

                                    $("#loaderDiv").show();

                                    var myformdata = $("#myForm").serialize();
                                    $.ajax({
                                        type: "POST",
                                        url: "@Url.Action("_Real", "Real")",
                                        data: myformdata,
                                        success: function () {
                                            $("#loaderDiv").hide();
                                            $("#myModal").modal("hide");
                                        }
                                    })
                                })

                            }

                            $("#myModal").modal("toggle");
                            $("#codeudorovalor").val("val");
                        }

                    },
                    error: function () {

                        swal('Oops..', 'Debe Seleccionar Una Garantia..!', 'info')

                    }
                });
                return false;
            });
        });
    </script><!--¨Parte de garantias-->

    <script>
        $('#gar').click(function () {
            $("#Real_Valor").val("");
            var valorPag = $('#Pagare').val();

            if (valorPag == null || valorPag == 0) {
                $('#Real_Valor').attr('readonly', true);
                $('#btnSubmit').attr("disabled", true);
                swal("Debe Ingresar Un Valor de Pagaré");

            }
            else if (valorPag != null || valorPag != 0) {
                $('#PagareId').val(valorPag);
                $("#btnSubmit").click(function () {

                    $("#loaderDiv").show();

                    var myformdata = $("#myForm").serialize();
                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("_Real", "Real")",
                        data: myformdata,
                        success: function () {
                            $("#loaderDiv").hide();
                            $("#myModal").modal("hide");
                        }
                    })
                })
            }
        })
        //Personal

        $('#gar').click(function () {
            var valorPag = $('#Pagare').val();

            if (valorPag == null || valorPag == 0) {
                $('#NIT').attr('readonly', true);
                $('#btnSubmit2').attr("disabled", true);
                swal("Debe Ingresar Un Valor de Pagare");

            }
            else if (valorPag != null || valorPag != 0) {
                $('#PagarePer').val(valorPag);
                $("#btnSubmit2").click(function () {

                    $("#loaderDiv2").show();

                    var myformdata = $("#myForm2").serialize();
                    //var myformdata = $("#NIT, #Prestamos_id").serialize();

                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("Create","Personal")",
                        data: myformdata,
                        success: function () {
                            $("#loaderDiv2").hide();
                            $("#myModal2").modal("hide");

                        }

                    })
                })
            }
        })
    </script><!--Garantias-->

    <script>
        $(document).ready(function () {
            $('#Lineas_Id').change(function ()
            {
                $('#Destino_Id').empty();
                $.ajax({
                    type: "POST",
                    //url: "/Costos_Adicionales/GetStatesByCountryId",
                    url: "@Url.Action("GetStatesByCountryId", "Costos_Adicionales")",
                    datatype: "Json",
                    data: { countryId: $('#Lineas_Id').val() },
                    success: function (data) {
                        $.each(data, function (index, value) {
                            $('#Destino_Id').append('<option value="' + value.Value + '">' + value.Text + '</option>');
                        });

                    }
                });
            });

            //subdestinos
            $('#Destino_Id').change(function () {
                //Traer el pagare de forma automatica
                $.ajax({
                    type: "POST",
                    //url: "/Costos_Adicionales/GetStatesByCountryId",
                    url: "@Url.Action("GetPagare", "CConsecutivos")",
                    datatype: "Json",
                    data: { paramIdDestino: $('#Destino_Id').val() },
                    success: function (data) {
                        if (data.cod == "Pagare no Configurado") {
                            swal({
                                title: "Alerta",
                                type: "info",
                                text: "El destino seleccionado no tiene un pagaré configurado",
                            })
                            $('#Pagare').val("");
                        } else {
                            $('#Pagare').val(data.cod + data.actual + "(" + data.prestamo + ")");
                            if (data.esaut == 1) {
                                $('#Pagare').attr("readonly", "readonly");
                            }
                        }
                        if (data.interesminimo == 1) {
                            /*$("#Interes").attr("readonly", "readonly");*/
                        } else {
                            $("#Interes").removeAttr("readonly", "readonly");
                        }
                        $("#Interes").val(data.tminima);
                    }
                });

                $('#Capital').attr("disabled", false);
                //$('#Interes').attr("disabled", false);
                $('#Plazo').attr("disabled", false);

                $('#Subdestino_Id').empty();
                $.ajax({
                    type: "POST",
                    //url: "/Costos_Adicionales/GetStatesByCountryId",
                    url: "@Url.Action("GetStatesBysubdestinoId", "Costos_Adicionales")",
                    datatype: "Json",
                    data: { SubId: $('#Destino_Id').val() },
                    success: function (data) {
                        $.each(data, function (index, value) {
                            $('#Subdestino_Id').append('<option value="' + value.Value + '">' + value.Text + '</option>');
                        });

                    }
                });
            });



        });
    </script><!--Llamar Lineas-Destino-Subdestinos-->

    <script>
        $(document).ready(function ()
        {
            $('#Destino_Id').change(function () {
                $('#bodyCostosAdicionales').empty();
                $.ajax({
                    type: "POST",
                    //url: "/Costos_Adicionales/GetStatesByCountryId",
                    url: "@Url.Action("GetCostosAdicionales", "Prestamos")",
                    datatype: "Json",
                    data: { Costos: $('#Destino_Id').val() },
                    success: function (data) {
                        data = JSON.parse(data);
                        $.each(data, function (key, val) {
                            var tr = '<tr>';
                            tr += '<td>' + (key + 1) + '</td>';
                            tr += '<td>' + val.Cuenta_Cod + '</td>';
                            tr += '<td>' + val.CA_Nombre + '</td>';
                            tr += '<td>' + val.CA_Porcentaje + '</td>';
                            tr += '<td>' + val.CA_Valor + '</td>';
                            tr += '<td class="hide"> ' + val.CA_Id + '</td>';
                            //tr += '<td><a class="delete btn btn-danger btn-xs" data-key="' + (key + 1) + '">Eliminar</a></td>';
                            tr += '<td><a class="agregar btn btn-success btn-xs" data-key="' + (key + 1) + '">Seleccionar</a></td>';
                            if (val.CA_Valor == 0) {
                                tr += '<td><select id="sel"" class="form-control"><option value="5">COSTO ADICIONAL ANTICIPADO</option><option value="6">COSTO ADICIONAL EN EL TIEMPO</option><option value="7">COSTO ADICIONAL EN CADA CUOTA</option></select></td>';
                            } else {
                                tr += '<td><select id="sel"" class="form-control"><option value="1">COSTO ADICIONAL EN CADA CUOTA</option><option value="2">COSTO ADICIONAL DIVIDIDO EN EL TIEMPO</option><option value="3">COSTO ADICIONAL PRIMERA CUOTA</option><option value="4">COSTO ADICIONAL ANTICIPADO</option></select></td>';
                            }
                            tr += '</tr>';
                            $('#bodyCostosAdicionales').append(tr);
                        });
                        var porc = 0;
                        var costoAdicionalEnEltiempo = 0;
                        var costoAdicionalAnticipado = 0;
                        var costoAdicionalPrimeraCuota = 0;
                        var costoAdicionalDividoEnElTiempo = 0;
                        var ValorPorcentajeCostoAnticipado = 0;
                        var ValorPorcentajeCostoEnCadaCuota = 0;
                        $('a.agregar').on('click', function ()
                        {
                            var cRow = $(this).parents('tr'); //datos en json
                            var cId = $('td:nth-child(2)', cRow).text(); //cid= numero de columna este caso ID
                            var nombre = $('td:nth-child(3)', cRow).text();
                            var Porcentaje = $('td:nth-child(4)', cRow).text();
                            var Valor = $('td:nth-child(5)', cRow).text();
                            var CA_Id = $('td:nth-child(6)', cRow).text();
                            var secobracomo = cRow.find("#sel").val();
                            var secobracomoTexto = "";
                            $('#CA_Id').val(CA_Id);

                            var valorPag = $('#Pagare').val();
                            if (valorPag == null || valorPag == 0) {
                                swal("Debe Ingresar Un Valor de Pagaré!!!...");
                            }
                            else if (valorPag != null || valorPag != 0) {
                                swal({
                                    title: "Agregar Costo Adicional?..\n" + nombre + "",
                                    type: "success",
                                    confirmButtonClass: "btn-success",
                                    confirmButtonText: "Aceptar",
                                    showCancelButton: true,
                                },
                                function ()
                                {
                                    if (secobracomo == 1) {
                                        costoAdicionalEnEltiempo = costoAdicionalEnEltiempo + parseFloat(Valor);
                                        alert(costoAdicionalEnEltiempo);
                                        $('#costoAdicionalEnEltiempo').val(costoAdicionalEnEltiempo);
                                        secobracomoTexto = "COSTO ADICIONAL EN CADA CUOTA";
                                    } else if (secobracomo == 4) {
                                        costoAdicionalAnticipado = costoAdicionalAnticipado + parseFloat(Valor);
                                        $('#costoAdicionalAnticipado').val(costoAdicionalAnticipado);
                                        secobracomoTexto = "COSTO ADICIONAL ANTICIPADO";
                                    } else if (secobracomo == 3) {
                                        costoAdicionalPrimeraCuota = costoAdicionalPrimeraCuota + parseFloat(Valor);
                                        $('#costoAdicionalPrimeraCuota').val(costoAdicionalPrimeraCuota);
                                        secobracomoTexto = "COSTO ADICIONAL PRIMERA CUOTA";
                                    } else if (secobracomo == 2) {
                                        costoAdicionalDividoEnElTiempo = costoAdicionalDividoEnElTiempo + parseFloat(Valor);
                                        $('#costoAdicionalDividoEnElTiempo').val(costoAdicionalDividoEnElTiempo);
                                        secobracomoTexto = "COSTO ADICIONAL DIVIDIDO EN EL TIEMPO";
                                    } else if (secobracomo == 5) {
                                        ValorPorcentajeCostoAnticipado = ValorPorcentajeCostoAnticipado + parseFloat(Porcentaje);
                                        $('#ValorPorcentajeCostoAnticipado').val(ValorPorcentajeCostoAnticipado);
                                        secobracomoTexto = "COSTO ADICIONAL ANTICIPADO";
                                    } else if (secobracomo == 6) {
                                        porc = porc + parseFloat(Porcentaje);
                                        $('#ValorSeguroPorcentaje').val(porc);
                                        secobracomoTexto = "COSTO ADICIONAL EN EL TIEMPO";
                                    } else if (secobracomo == 7) {
                                        ValorPorcentajeCostoEnCadaCuota = ValorPorcentajeCostoEnCadaCuota + parseFloat(Porcentaje);
                                        $('#ValorPorcentajeCostoEnCadaCuota').val(ValorPorcentajeCostoEnCadaCuota);
                                        secobracomoTexto = "COSTO ADICIONAL EN CADA CUOTA";
                                    }

                                    var data = {
                                        CA_Id: $('#CA_Id').val().trim(),
                                        Pagare: $('#Pagare').val().trim(),
                                        seCobraComo: secobracomo
                                    }
                                    $.ajax({
                                        type: "POST",
                                        url: "@Url.Action("AddCostos","Prestamos")",
                                        data: JSON.stringify(data),
                                        contentType: 'application/json',

                                        success: function () {0
                                            $.ajax({
                                                type: "POST",
                                                url: "@Url.Action("qDeleteCA", "Prestamos")",
                                                datatype: "Json",
                                                data: { pagare: $('#Pagare').val(), CA_Id: CA_Id },
                                                success: function (data) {
                                                   data = JSON.parse(data);
                                                    $.each(data, function (key, val) {
                                                        var tr = '<tr>';
                                                        tr += '<td>' + (key + 1) + '</td>';
                                                        tr += '<td>' + val.Cuenta_Cod + '</td>';
                                                        tr += '<td>' + val.CA_Nombre + '</td>';
                                                        tr += '<td>' + val.CA_Porcentaje + '</td>';
                                                        tr += '<td>' + val.CA_Valor + '</td>';
                                                        tr += '<td class="hide"> ' + val.CA_Id + '</td>';
                                                        tr += '<td class="hide"> ' + val.Id_CostoPretamo + '</td>';
                                                        tr += '<td> ' + secobracomoTexto + '</td>';
                                                        //tr += '<td><a class="delete btn btn-danger btn-xs" data-key="' + (key + 1) + '">Eliminar</a></td>'; //DESABILITADA HASTA TERMINAR VALIDACIONES
                                                        tr += '</tr>';
                                                        $('#CostosSeleccionados').append(tr);
                                                    });

                                                    $('a.delete').on('click', function ()
                                                    {
                                                        var cRow = $(this).parents('tr'); //datos en json
                                                        var cId = $('td:nth-child(7)', cRow).text(); //cid= numero de columna este caso ID
                                                        var IDC = parseInt(cId);
                                                        GetValorDecreciente(IDC);
                                                        swal({
                                                                title: "Eliminar Costo?",
                                                                text: "Esta Seguro de Eliminar El Costo Adicional?",
                                                                type: "warning",
                                                                showCancelButton: true,
                                                                closeOnConfirm: false,
                                                                confirmButtonText: "Eliminar",
                                                                confirmButtonColor: "#ec6c62"
                                                            },
                                                            function ()
                                                            {
                                                                $.ajax({
                                                                    url: "/Prestamos/DeleteCA/",
                                                                    data: { id: cId },
                                                                    type: "POST"
                                                                })
                                                                .done(function (data) {
                                                                    sweetAlert
                                                                        ({
                                                                            title: "Eliminado!",
                                                                            text: "El Costo Fue Eliminado Con Exito!",
                                                                            type: "success"
                                                                        },
                                                                            function () {
                                                                                cRow.fadeOut('slow', function () {
                                                                                    //aqui va la funcion
                                                                                });

                                                                            });

                                                                })
                                                                .error(function (data) {
                                                                    swal("Oops", "Ha Ocurrido Un Error!", "error");
                                                                });
                                                            });
                                                    })
                                                }
                                            })
                                        }
                                    })

                                    swal('Usted Ha Seleccionado\nEl Costo Adicional: \n $' + Valor + '  Mil');

                                    //FUNCION SUSTRACCION DE % Y VALORES
                                    //===================================

                                    function GetValorDecreciente(IDC) {

                                        var valorf = $('#ValorSeguro').val();
                                        var porcentaje = $('#ValorSeguroPorcentaje').val();

                                        if (valorf != 0 && porcentaje == 0) {
                                            val = parseFloat(valorf);
                                            $.ajax({
                                                type: "POST",
                                                //url: "/Costos_Adicionales/GetStatesByCountryId",
                                                url: "@Url.Action("qDecrecienteCA", "Prestamos")",
                                                datatype: "Json",
                                                data: { pagare: $('#Pagare').val(), CA_Id: CA_Id, valor: val, idCoPre: IDC },

                                                success: function (data) {

                                                    data = JSON.parse(data);
                                                    $('#ValorSeguro').val(data);
                                                }
                                            })//fin ajax

                                        }
                                        else if (porcentaje != 0 && valorf == 0) {

                                            $.ajax({
                                                type: "POST",
                                                //url: "/Costos_Adicionales/GetStatesByCountryId",
                                                url: "@Url.Action("qDecrep", "Prestamos")",
                                                datatype: "Json",
                                                data: { pagare: $('#Pagare').val(), CA_Id: CA_Id, porciento: porcentaje, idCoPre: IDC },

                                                success: function (data) {

                                                    data = JSON.parse(data);
                                                    $('#ValorSeguroPorcentaje').val(data);
                                                }
                                            })//fin ajax

                                        }
                                        else if (valorf != 0 && porcentaje != 0) {
                                            val = parseFloat(valorf);
                                            $.ajax({
                                                type: "POST",
                                                //url: "/Costos_Adicionales/GetStatesByCountryId",
                                                url: "@Url.Action("qDecrepVP", "Prestamos")",
                                                datatype: "Json",
                                                data: { pagare: $('#Pagare').val(), CA_Id: CA_Id, valor: val, porciento: porcentaje, idCoPre: IDC },

                                            success: function (data) {
                                                //data = JSON.parse(data);
                                                $.each(data, function (key, val) {
                                                    console.log(data.POR);
                                                    console.log(data.VAL);
                                                    $('#ValorSeguroPorcentaje').val(data.POR);
                                                    $('#ValorSeguro').val(data.VAL);
                                                })
                                            }
                                        })//fin ajax
                                        }
                                    }

                                    var intKey = $(this).data('key'); //Autoincremental

                                    cRow.fadeOut('slow', function () {

                                        // doDelete(cId, intKey);
                                    });

                                }, //fin primera funcion

                                function (cancel) {
                                    swal(true, 'Your imaginary file is safe :)', 'error')
                                }
                                )//fin swall
                            }//fin else if
                        });//fin funcion agregar


                        function doDelete(param1, param2) {
                            swal('Datos a Eliminar\n\nId: ' + param1 + '\nAutonumerico: ' + param2 + '');
                        }
                    }

                });
            });
        });
    </script><!--Costos Adicionales-->

    <script>
        $(document).ready(function (){
            $("#Tipo_Periodo_Id").change(function () {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("GetValorTipoPeriodo", "Prestamos")",
                    datatype: "Json",
                    data: { IdPeriodo: $('#Tipo_Periodo_Id').val() },
                    success: function (data) {
                        $.each(data, function (index, value) {
                            console.log(data);
                            $('#ValorPeriodo').val(data);
                        });
                    }
                });
            });
        });
    </script><!--Get Valor tipo periodo-->

    <script>
        $('#Plazo').focus(function () {
            var FechaPrestamo = $("#Fecha_Prestamo").val();
            var per = $("#ValorPeriodo").val();
            var FechaActual = sumaFecha(per, FechaPrestamo);
            $('#FechaPrimerPago').val(FechaActual);
        })

        $('#Plazo').change(function () {
            var FechaPrestamo = $("#Fecha_Prestamo").val();
            var per = $("#ValorPeriodo").val();
            /*
            var patron = /^(\d{1,2})-(\d{1,2})-(\d{4})$/;
            var arrayFecha = FechaPrestamo.match(patron);
            var fecha = new Date(arrayFecha[3], arrayFecha[2] - 1, arrayFecha[1]);
            */
            var FechaActual = sumaFecha(per, FechaPrestamo);
            $('#FechaPrimerPago').val(FechaActual);
        })
    </script><!--FUNCION QUE CALCULA LA FECHA DEL PRIMER PAGO DE ACUERDO AL PERIODO-->

    <script>

        function GetCostoAdicionalAnticipado(capital) {
            let valor = 0;
            var IdDestino = $("#Destino_Id").val();
            if (IdDestino == "2") {
                if (capital >= 0 && capital <= 10000000) { valor = parseFloat(capital * 0.015); }
                else if (capital > 10000000 && capital <= 15000000) { valor = parseFloat(capital * 0.012); }
                else { valor = parseFloat(capital * 0.01); }
            }
            return valor;
        }

        function Amotizacion() {
            /*Swal.fire('Descargar Autorizacion para tratameinto de Datos', '', 'info')*/
            alert("Descargar Autorizacion para tratamiento de Datos");
            $("#TablaAmortizacion").empty();
            $("#interes").empty();
            $("#capitalDescuentos").empty();
            var seleccion = $("#myselect").val();
            var Capital = parseInt($("#Capital").val());

            var Interes = $("#Interes").val();
            
            var Plazo = $("#Plazo").val();
            var plazo = parseFloat(Plazo);
            var Periodo = $("#Tipo_Periodo_Id").val();

            var Int = (parseFloat(Interes) / 100).toFixed(3);

            var cuota = Capital * (Int / (1 - Math.pow((1 + Int), -plazo)));


            var InteresMensual = 0;
            var amortizacion = 0;
            var amortizacion_total = 0;
            // Calculo de Fecha
            var Periodo = $("#ValorPeriodo").val();
            var Per = parseInt(Periodo);
            var FechaPrestamo = $("#Fecha_Prestamo").val();
            




            //Fecha actual
            var d = new Date();
            var month = d.getMonth() + 1;
            var day = d.getDate();
            var output = (day < 10 ? '0' : '') + day + '/' +
                (month < 10 ? '0' : '') + month + '/' +
                d.getFullYear();
            $("#fechadesembolso").val(output);
            //Fin Fecha actual
            //var FechaActual = new date(FechaPrestamo);
            //Funcion que recibe la cantidad de dias transcurridos desde la fecha de prestamo
            var difdias = diferencia(output, FechaPrestamo);
            $("#difdias").val(difdias);
            //calculo del valor del interes ValDiasInt=valor dias interes
            var ValDiasInt = (Capital * Int / 30) * difdias;

            ValDiasInt = Math.round(ValDiasInt);


            //alert(ValDiasInt);
            $("#ValDiasInt").val(ValDiasInt);
            // alert($("#ValDiasInt").val());
            //retorno de la ultmima fecha del mes
            var UltDia = ultimodia();
            //suma el periodo a la fecha del prestamos
            var FechaActual = sumaFecha(Per, UltDia);
            var ValorPorcentajeCostoAnticipado = 0;
            var costoAdicionalAnticipado = 0;
            var ValorPorcentajeCostoEnCadaCuota = 0;
            ValorPorcentajeCostoAnticipado = $("#ValorPorcentajeCostoAnticipado").val();
            ValorPorcentajeCostoEnCadaCuota = $("#ValorPorcentajeCostoEnCadaCuota").val();
            var costoAdicionalEnEltiempo = parseInt($("#costoAdicionalEnEltiempo").val());
            var costoAdicionalAnticipado = parseInt($("#costoAdicionalAnticipado").val());
            if (ValorPorcentajeCostoAnticipado != 0) {
                costoAdicionalAnticipado = GetCostoAdicionalAnticipado(Capital);//(costoAdicionalAnticipado + ((parseFloat(ValorPorcentajeCostoAnticipado) / 100) * Capital));
                costoAdicionalAnticipado = parseInt(costoAdicionalAnticipado);
            }
            var costoAdicionalPrimeraCuota = parseInt($("#costoAdicionalPrimeraCuota").val());
            var costoAdicionalDividoEnElTiempo = parseInt($("#costoAdicionalDividoEnElTiempo").val());
            if (costoAdicionalDividoEnElTiempo != 0) {
                costoAdicionalDividoEnElTiempo = Math.round((costoAdicionalDividoEnElTiempo / plazo), 2);
            }

            var ValorPorcentaje = $("#ValorSeguroPorcentaje").val();
            ValorPorcentajeParaTabla = 0;
            if (ValorPorcentaje != 0) {
                ValorPorcentaje = parseFloat(ValorPorcentaje) / 100;
                ValorPorcentajeParaTabla = (Capital * ValorPorcentaje);


            } else {
                ValorPorcentaje = 1;
                ValorPorcentajeParaTabla = 0;
            }
            if (ValorPorcentajeCostoEnCadaCuota != 0) {
                ValorPorcentajeCostoEnCadaCuota = parseFloat(ValorPorcentajeCostoEnCadaCuota) / 100;
                ValorPorcentajeCostoEnCadaCuota = (((Capital * ValorPorcentajeCostoEnCadaCuota) / 12) * plazo);
                ValorPorcentajeCostoEnCadaCuota = parseInt(ValorPorcentajeCostoEnCadaCuota);
                costoAdicionalEnEltiempo = costoAdicionalEnEltiempo + ValorPorcentajeCostoEnCadaCuota;
            }
            var CapitalMenoscostoAdicionalAnticipado = Capital - costoAdicionalAnticipado;

            var IdDestino = $("#Destino_Id").val();

            $.ajax({
                @*url: "@Url.Action("GetAmortizacion", "Prestamos")",*@
                url: "/Creditos/Prestamos/GetAmortizacion",
                datatype: "Json",
                data: {
                    seleccion: seleccion,
                    capital: Capital,
                    interes: Int,
                    plazo: plazo,
                    FechaPrestamo: FechaPrestamo,
                    VPS: ValorPorcentajeParaTabla,
                    costoAdicionalEnEltiempo: costoAdicionalEnEltiempo,
                    costoAdicionalAnticipado: costoAdicionalAnticipado,
                    ValorPorcentajeCostoAnticipado: ValorPorcentajeCostoAnticipado,
                    ValorPorcentajeCostoEnCadaCuota: ValorPorcentajeCostoEnCadaCuota,
                    ValDiasInt: ValDiasInt,
                    costoAdicionalPrimeraCuota: costoAdicionalPrimeraCuota,
                    costoAdicionalDividoEnElTiempo: costoAdicionalDividoEnElTiempo,
                    Periodo: Per,
                    IdDestino: IdDestino
                },
                type: 'post',
            }).done(function (data) {
                if (data.status == true) {
                    $.each(data.list, function (index, value) {
                        $("#TablaAmortizacion").append("<tr><td>" + value[0] + "</td><td>" + value[1] + "</td><td>" + value[2] + "</td><td>" + value[3] + "</td><td>" + value[4] + "</td><td>" + value[5] + "</td><td>" + value[6] + "</td><td>" + value[7] + "</td></tr>");
                    });

                    $("#auxCostoAdicionalEnEltiempo").val(costoAdicionalEnEltiempo);
                    $("#auxCostoAdicionalDividoEnElTiempo").val(costoAdicionalDividoEnElTiempo);
                    $("#auxValorPorcentajeCostoAnticipado").val(ValorPorcentajeCostoAnticipado);
                    $("#auxValorPorcentajeCostoEnCadaCuota").val(ValorPorcentajeCostoEnCadaCuota);
                }
                else if (data.status == false) {

                }

            }).fail(function (jqXHR, textStatus, errorThrown) {

            });


            var tr = $("<tr>")
                .append($("<td>", { html: formato_numero(Capital.toFixed(0), 0, ".", ".") }))
                .append($("<td>", { html: formato_numero(costoAdicionalAnticipado.toFixed(0), 0, ".", ".") }))
                .append($("<td>", { html: formato_numero(CapitalMenoscostoAdicionalAnticipado.toFixed(0), 0, ".", ".") }))
            $("#capitalDescuentos").append(tr);

            var tr = $("<tr>")
                .append($("<td>", { html: output }))
                .append($("<td>", { html: FechaPrestamo }))
                .append($("<td>", { html: difdias }))
                .append($("<td>", { html: ValDiasInt }))
            $("#interes").append(tr);

            var x = 0;

            //abono interes
            var AbonoInteres = 0;
            AbonoInteres = Capital * (Interes / 100);
            var AI = 0;

            //abono capital
            var AbonoCapital = 0;
            AbonoCapital = cuota - AbonoInteres;
            var Abc = 0;
            var selecccion = 0;

            //if (seleccion == 2 && ValDiasInt != 0) {
            //    costoAdicionalEnEltiempo = costoAdicionalEnEltiempo + (ValDiasInt / Plazo);
            //    alert(costoAdicionalEnEltiempo);
            //} else if (seleccion == 3) {
            //    costoAdicionalPrimeraCuota = costoAdicionalPrimeraCuota + ValDiasInt;
            //}

            //var ValorCuota = 0;
            //ValorCuota = (AbonoCapital + AbonoInteres + costoAdicionalEnEltiempo + costoAdicionalPrimeraCuota + costoAdicionalDividoEnElTiempo + ValorPorcentaje + ValorPorcentajeParaTabla);
            //ValorCuotaSinCostoAdicionalPrimeraCuota = (AbonoCapital + AbonoInteres + costoAdicionalEnEltiempo + costoAdicionalDividoEnElTiempo + ValorPorcentaje);
            //var ValorCostoFijo = costoAdicionalEnEltiempo + costoAdicionalPrimeraCuota + costoAdicionalDividoEnElTiempo;
            //var ValorCostoFijoSinCostoPrimeraCuotaSinInteresAnticipado = costoAdicionalEnEltiempo + costoAdicionalDividoEnElTiempo;
            //var SaldoCapital = 0;
            //SaldoCapital = Capital - AbonoCapital;
            //SC = 0;


        }

    </script><!--Amortizacion-->

    <script>
        function formato_numero(numero, decimales, separador_decimal, separador_miles) { // v2007-08-06
            numero = parseFloat(numero);
            if (isNaN(numero)) {
                return "";
            }

            if (decimales !== undefined) {
                // Redondeamos
                numero = numero.toFixed(decimales);
            }

            // Convertimos el punto en separador_decimal
            numero = numero.toString().replace(".", separador_decimal !== undefined ? separador_decimal : ",");

            if (separador_miles) {
                // Añadimos los separadores de miles
                var miles = new RegExp("(-?[0-9]+)([0-9]{3})");
                while (miles.test(numero)) {
                    numero = numero.replace(miles, "$1" + separador_miles + "$2");
                }
            }

            return numero;
        }

    </script><!--Formatear Un numero-->

    <script>
        sumaFecha = function (d, fecha) {
            var Fecha = new Date();
            var sFecha = fecha || (Fecha.getDate() + "/" + (Fecha.getMonth() + 1) + "/" + Fecha.getFullYear());
            var sep = sFecha.indexOf('/') != -1 ? '/' : '-';
            var aFecha = sFecha.split(sep);
            var fecha = aFecha[2] + '/' + aFecha[1] + '/' + aFecha[0];
            fecha = new Date(fecha);
            fecha.setDate(fecha.getDate() + parseInt(d));
            var anno = fecha.getFullYear();
            var mes = fecha.getMonth() + 1;
            var dia = fecha.getDate();
            mes = (mes < 10) ? ("0" + mes) : mes;
            dia = (dia < 10) ? ("0" + dia) : dia;
            var fechaFinal = dia + sep + mes + sep + anno;
            return (fechaFinal);
        }
    </script><!--Funcion que suma la cantidad de dias en javascript-->

    <script>
        $(document).ready(function () {
            $('#NIT').autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "/Prestamos/GetCedula",
                        data: { Prefix: request.term },
                        dataType: 'json',
                        type: 'POST',
                        success: function (data) {
                            response($.map(data, function (item) {
                                return {
                                    label: item.NOMBRE,
                                    CEDULA: item.NIT,
                                    value: item.NOMBRE,
                                    SALARIO: item.SALARIO
                                }
                            }));
                        }
                    })
                },
                select: function (event, ui) {
                    $('#NIT').val(ui.item.CEDULA);
                    $('#NOMBRE').val(ui.item.value);
                    $('#SALARIO').val(ui.item.SALARIO);
                    //Separador de miles para salario
                    var entradac = $('#SALARIO').val();
                    var numc = entradac.replace(/\./g, "");
                    if (!isNaN(numc)) {
                        numc = numc.toString().split("").reverse().join("").replace(/(?=\d*\?)(\d{3})/g, "$1.");
                        numc = numc.split("").reverse().join("").replace(/^[\.]/, "");
                        entradac = numc;
                    } else {
                        entradac = input.value.replace(/[^\d\.]*/g, "");
                    }
                    $('#SALARIO').val(entradac);
                    //Fin Separador de miles
                    return false;
                },
                minLength: 1
            });
        })
    </script><!--AUTOCOMPLETE ASOCIADO-->

    <script src="~/Scripts/moment.js"></script><!--Libreria para manejo de fechas u operaciones con dias-->

    <script>
        diferencia = function (fechaactual, aFecha2) {
            var date = new Date();
            var month = new Array();
            month[0] = "01";
            month[1] = "02";
            month[2] = "03";
            month[3] = "04";
            month[4] = "05";
            month[5] = "06";
            month[6] = "07";
            month[7] = "08";
            month[8] = "09";
            month[9] = "10";
            month[10] = "11";
            month[11] = "12";
            var n = month[date.getMonth()];

            //var primerDia = new Date(date.getFullYear(), date.getMonth(), 1);
            var ultimoDia = new Date(date.getFullYear(), date.getMonth() + 1, 0);

            var UltimoD = ultimoDia.getDate() + "/" + n + "/" + ultimoDia.getFullYear();

            var aFecha1 = fechaactual.split('/');
            aFecha2 = aFecha2.split('/');
            var fFecha1 = Date.UTC(aFecha1[2], aFecha1[1] - 1, aFecha1[0]);
            var fFecha2 = Date.UTC(aFecha2[2], aFecha2[1] - 1, aFecha2[0]);
            var dif = fFecha2 - fFecha1;
            var dias = Math.floor(dif / (1000 * 60 * 60 * 24));

            return (dias);
        }

        //RETORNAR EL ULTIMO DIA DEL MES
        ultimodia = function () {
            var date = new Date();
            var month = new Array();
            month[0] = "01";
            month[1] = "02";
            month[2] = "03";
            month[3] = "04";
            month[4] = "05";
            month[5] = "06";
            month[6] = "07";
            month[7] = "08";
            month[8] = "09";
            month[9] = "10";
            month[10] = "11";
            month[11] = "12";
            var n = month[date.getMonth()];
            //var primerDia = new Date(date.getFullYear(), date.getMonth(), 1);
            var ultimoDia = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            var UltimoD = ultimoDia.getDate() + "/" + n + "/" + ultimoDia.getFullYear();
            return (UltimoD);
        }
    </script><!--Operaciones con dias-->

    <script>
        //FUNCION QUE VALIDA CAPITAL, INTERES Y PLAZO DE ACUERDO A UN DESTINO SELECCIONADO
        //================================================================================
        $(document).ready(function () {
            //CAPITAL
            //=======
            $("#Prestamo").blur(function () {
                //validar cajas vacias
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("QueryCap", "Prestamos")",
                    datatype: "Json",
                    data: {
                        Destino: $('#Destino_Id').val().trim(),
                        Capital: $('#Capital').val().trim(),
                    },
                    success: function (data) {
                        if (data.status) {
                            $.each(data.capital, function (key, val) {
                                $('#Prestamo').focus();
                                swal({
                                    title: "Destino:" + " " + JSON.stringify(val.Destino_Descripcion),
                                    text:
                                    'Capital:  DESDE' + " " + "$" + JSON.stringify(val.Destino_Valor_Minimo) + " " + "HASTA:" + "$" + JSON.stringify(val.Destino_Valor_Maximo) + "\n \n",
                                    type: 'error',
                                    confirmButtonText: 'Aceptar'
                                })
                            })
                            $('#Capital').val("");
                            $('#Prestamo').val("");
                            $('#Prestamo').focus();
                        }//fin if mayor
                    }
                });
            });
            //INTERES
            //==========
            $("#Interes").blur(function () {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("QueryInt", "Prestamos")",
                    datatype: "Json",
                    data: {
                        Destino: $("#Destino_Id").val().trim(),
                        Interes: $("#Interes").val().trim(),
                    },
                    success: function (data) {

                        if (data.status) {
                            console.log(data.status);
                            console.log(data.interes);
                            $.each(data.interes, function (key, val) {
                                $('#Interes').focus();
                                swal({
                                    title: "Destino:" + " " + JSON.stringify(val.Destino_Descripcion),
                                    text:

                                    "Tasa Interes: DESDE:" + " " + JSON.stringify(val.Destino_Tasa_Minima) + "%" + " " + "HASTA:" + " " + JSON.stringify(val.Destino_Tasa_Maxima) + "%",
                                    //"Plazo: DESDE:" + " " + JSON.stringify(val.Destino_Periodo_Minimo) + " " + "Meses" + " " + "HASTA:" + " " + JSON.stringify(val.Destino_Periodo_Maximo) + " " + "Meses",
                                    type: 'error',

                                    confirmButtonText: 'Aceptar'
                                })
                            })
                            /*alert("entro 1")*/
                            $('#Interes').val("");
                            $('#Interes').focus();
                            //$('#Plazo').val("");
                        }

                    }
                })
            })

            //PLAZO
            //=======
            $("#Plazo").blur(function () {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("QueryPlazo", "Prestamos")",
                    datatype: "Json",
                    data: {
                        Destino: $("#Destino_Id").val().trim(),
                        Plazo: $("#Plazo").val().trim(),
                    },
                    success: function (data) {

                        if (data.status) {

                            $.each(data.plazo, function (key, val) {
                                $('#Plazo').focus();
                                swal({
                                    title: "Destino:" + " " + JSON.stringify(val.Destino_Descripcion),
                                    text:

                                    "Plazo: DESDE:" + " " + JSON.stringify(val.Destino_Periodo_Minimo) + " " + "Meses" + " " + "HASTA:" + " " + JSON.stringify(val.Destino_Periodo_Maximo) + " " + "Meses",
                                    type: 'error',

                                    confirmButtonText: 'Aceptar'



                                })

                            })


                            $('#Plazo').val("");
                            $('#Plazo').focus();
                        }

                    }
                })
            })
        });
    </script><!--FUNCION QUE VALIDA CAPITAL, INTERES Y PLAZO DE ACUERDO A UN DESTINO SELECCIONADO-->

    <script>
        // SEPARADOR DE MILES
        // ==================



        $("#Prestamo").keyup(function () {
            var entrada = $("#Prestamo").val().split('.').join('');
            entrada = entrada.split('').reverse();
            var salida = [];
            var aux = '';

            var paginador = Math.ceil(entrada.length / 3);

            for (let i = 0; i < paginador; i++) {
                for (let j = 0; j < 3; j++) {

                    if (entrada[j + (i * 3)] != undefined) {
                        aux += entrada[j + (i * 3)];
                    }
                }
                salida.push(aux);
                aux = '';
            }
            var string = salida.join('.').split("").reverse().join('');
            var double = parseFloat(string);
            $("#Prestamo").val(string);


        })

        $(document).ready(function () {

            $('#Prestamo').keyup(function () {
                var value = $(this).val();

                var entrada = $("#Prestamo").val();
                var punto = entrada.split('.').join("");
                var valor = parseFloat(punto);
                $('#Capital').val(valor);
            });
        });


        $("#Real_Valor").keyup(function () {

            var entrada = $("#Real_Valor").val().split('.').join('');
            entrada = entrada.split('').reverse();
            var salida = [];
            var aux = '';

            var paginador = Math.ceil(entrada.length / 3);

            for (let i = 0; i < paginador; i++) {
                for (let j = 0; j < 3; j++) {

                    if (entrada[j + (i * 3)] != undefined) {
                        aux += entrada[j + (i * 3)];
                    }
                }
                salida.push(aux);
                aux = '';
            }
            var string = salida.join('.').split("").reverse().join('');
            var double = parseFloat(string);
            $("#Real_Valor").val(string);


        })
        $('#btnSubmit').click(function () {
            /*$('#Real_Valor').keyup(function () {
                var value = $(this).val();*/

            var entrada = $("#Real_Valor").val();
            var punto = entrada.split('.').join("");
            var valor = parseFloat(punto);
            $('#Real_Valor').val(valor).hide();
            $('#valor').val(valor);
            //});
        });

    </script><!--SEPARADOR DE MILES-->

    <script>
        $('#CrearC').click(function () {


            var formapago = $("#Forma_Pago_Id").val();
            var realvalor = $("#Real_Valor").val();
            var codeudornombre = $("#codeudor").find('option:selected').text();
            var codeudorid = $("#codeudor").val();
            var codoval = $("#codeudorovalor").val();
            if (formapago != '') {
                if (codoval == "cod") {
                    if (codeudorid != '') {
                        $("#nombre_codeudor").val(codeudornombre);
                        $("#codeudor_nit").val(codeudorid);
                        //Quitar separador de miles
                        var enteroc = $('#SALARIO').val();
                        var enteroc1 = enteroc.replace(".", "");
                        var enteroc2 = enteroc1.replace(".", "");
                        enteroc2 = enteroc2.toString();
                        $('#SALARIO').val(enteroc2);
                        //Fin Quitar separador de miles
                        var ValorPorcentajeCostoAnticipado = $("#ValorPorcentajeCostoAnticipado").val();
                        var costoAdicionalAnticipado = parseInt($("#costoAdicionalAnticipado").val());
                        var Capital = parseInt($("#Capital").val());
                        if (ValorPorcentajeCostoAnticipado != 0) {
                            costoAdicionalAnticipado = GetCostoAdicionalAnticipado(Capital);//costoAdicionalAnticipado + ((parseFloat(ValorPorcentajeCostoAnticipado) / 100) * Capital)
                            $("#costoAdicionalAnticipado").val(costoAdicionalAnticipado);
                        }
                        var interesCorriente = $("#Interes").val();
                        $("#auxInteres").val(interesCorriente);
                        $('#theForm').submit();
                    } else {
                        swal({
                            title: "Alerta",
                            type: "info",
                            text: "Seleccione un codeudor",
                        })
                    }
                } else if (codoval == "val") {
                    if (realvalor != '' && realvalor != 0) {
                        $("#mivalor").val(realvalor);
                        //Quitar separador de miles
                        var enteroc = $('#SALARIO').val();
                        var enteroc1 = enteroc.replace(".", "");
                        var enteroc2 = enteroc1.replace(".", "");
                        enteroc2 = enteroc2.toString();
                        $('#SALARIO').val(enteroc2);
                        //Fin Quitar separador de miles
                        var ValorPorcentajeCostoAnticipado = $("#ValorPorcentajeCostoAnticipado").val();
                        var costoAdicionalAnticipado = parseInt($("#costoAdicionalAnticipado").val());
                        var Capital = parseInt($("#Capital").val());
                        if (ValorPorcentajeCostoAnticipado != 0) {
                            costoAdicionalAnticipado = GetCostoAdicionalAnticipado(Capital);//costoAdicionalAnticipado + ((parseFloat(ValorPorcentajeCostoAnticipado) / 100) * Capital)
                            $("#costoAdicionalAnticipado").val(costoAdicionalAnticipado);
                        }
                        var interesCorriente = $("#Interes").val();
                        $("#auxInteres").val(interesCorriente);
                        $('#theForm').submit();
                    } else {
                        swal({
                            title: "Alerta",
                            type: "info",
                            text: "Ingrese el valor de la garantia",
                        })
                    }
                } else {
                    swal({
                        title: "Alerta",
                        type: "info",
                        text: "Agrege una garantia",
                    })
                }

            } else {
                swal({
                    title: "Alerta",
                    type: "info",
                    text: "Seleccione una forma de pago",
                })
            }
        });

        $('#CrearC').prop("disabled", true);

        $('#Garantia_Id').change(function () {
            $('#garantia_id').val($('#Garantia_Id').val());//Para llenar la table GarantiasCreditos
            if ($('#Garantia_Id').val() == null) {

                $('#CrearC').prop("disabled", true);
            }
            else {

                $('#CrearC').prop("disabled", false);
            }
        })//fin blur
    </script><!--Validaciones antes de enviar formulario-->
}