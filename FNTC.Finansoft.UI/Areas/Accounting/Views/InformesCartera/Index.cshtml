@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles{

    <link href="~/Content/css/jquery-ui.min.css" rel="stylesheet" />
    <link href="~/Content/css/chosen.css" rel="stylesheet" />
    <script src="~/Scripts/sweetalert2@9.js"></script>
    <style>
        fieldset {
            min-width: 12px;
            padding: 12px;
            margin: 100px;
            border: 1px solid #F1F1F1;
        }

        legend {
            width: 25%;
            padding: 0;
            margin-bottom: 0px;
            font-size: 14px;
            line-height: inherit;
            color: #0026ff;
            border: 0;
            border-bottom: none;
        }

        ul.ui-autocomplete {
            max-height: 200px;
            max-width: 400px;
            overflow-y: auto; /* prevent horizontal scrollbar */
            overflow-x: hidden; /* add padding to account for vertical scrollbar */
            z-index: 5000;
        }
    </style>
}

<div class="row">
    <div class="col-md-8" style="margin-left:10%;margin-right:10%">
        <div id="menu" class="col-md-12" style="margin-top: 0%; ">
            <div class="col-md-12 tituloinformes">INFORMES DE CARTERA</div>
            <ul>
                <li><a href="#" data-toggle="modal" data-target="#librosaux" data-informe="1"><i class="fa fa-list-alt" aria-hidden="true"></i> Créditos</a></li>



                <li><a href="/InformesCartera/ExcelRSVFF"><i class="fa fa-list-alt" aria-hidden="true"></i>INFORME POSITIVA</a></li>
                <li><a href="#" data-toggle="modal" data-target="#librosaux" data-informe="3"><i class="fa fa-list-alt" aria-hidden="true"></i> Reporte de pagos </a></li>
                <li><a href="/InformesCartera/Excelpagos"><i class="fa fa-list-alt" aria-hidden="true"></i>Cartera Detallada</a></li>
                <li><a href="#" data-toggle="modal" data-target="#librosaux" data-informe="5"><i class="fa fa-list-alt" aria-hidden="true"></i> Informe Diario de Recuado</a></li>
                <li><a href="#" data-toggle="modal" data-target="#librosaux" data-informe="6"><i class="fa fa-list-alt" aria-hidden="true"></i> Informe Recaudo x Pagare </a></li>
                

            </ul>
        </div>
    </div>
    
    

</div>


<div class="alert alert-primary" role="alert">
    @ViewBag.error
</div>




@using (Html.BeginForm("ExcelSaldos", "InformesCartera"))
{
    @Html.ValidationSummary(false)
    <div class="modal fade" data-backdrop="static" id="librosaux" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header modalinformestiulo">
                    <i class="fa fa-book" id="title" aria-hidden="true"></i>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="informe" name="informe" />
                    <div class="col-md-10">
                        <div class="clearfix"></div>
                        <div id="selectPersonalDIV" style="margin-top:5px">
                            @*<label class="col-md-12 letrasinformes"></label>*@
                            <div class="col-md-10">
                                <select id="selectPersonal" class="form-control" name="selectPersonal">
                                    <option value="0">--Seleccione--</option>
                                    <option value="1">Sólo asociados</option>
                                    <option value="2">Todos los registros</option>
                                </select>
                            </div>
                        </div>
                        <table class="table" id="table1">
                            <thead>
                                <tr><th colspan="3"><h5>PERIODOS A REPORTAR</h5></th></tr>
                                <tr><th>Año</th><th id="tfrom">Desde</th><th>Hasta</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <select id="year" name="year" class="form-control" required></select>
                                    </td>
                                    <td id="tmini">
                                        <select class="form-control" id="monthini" name="monthini"></select>
                                    </td>
                                    <td>
                                        <select class="form-control" id="monthfin" name="monthfin"></select>
                                    </td>



                                </tr>
                            </tbody>
                        </table>
                        <table class="table" id="table2">
                            <thead>
                                <tr><th colspan="3"><h5>PERIODOS A REPORTAR</h5></th></tr>
                                <tr><th>Desde</th><th>Hasta</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <input type="date" id="fechaDesde" name="fechaDesde" class="form-control" />
                                    </td>
                                    <td>
                                        <input type="date" class="form-control" id="fechaHasta" name="fechaHasta" />
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                        <table class="table" id="table3">
                            <thead>
                                <tr><th colspan="3"><h5>PERIODOS A REPORTAR</h5></th></tr>
                                <tr><th>Hasta fecha pagos</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <input type="date" id="fechaDesde3" name="fechaDesde3" class="form-control" />
                                    </td>
                                    <td>
                                        <input type="date" class="form-control" id="fechaHasta3" name="fechaHasta3" />
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                        <div class="clearfix"></div>

                        <table class="table" id="table4">
                            <thead>
                                <tr><th colspan="3"><h5>PERIODOS A REPORTAR</h5></th></tr>
                                <tr><th>Año</th><th id="tfrom">Periodo</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <select id="year2" name="year2" class="form-control" required></select>
                                    </td>
                                    <td>
                                        <select class="form-control" id="periodoTrimestral" name="periodoTrimestral"></select>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                        <div class="clearfix"></div>
                        <table class="table" id="table5">
                            <thead>
                                <tr><th colspan="3"><h5>PERIODO A REPORTAR</h5></th></tr>
                                <tr><th>Periodo</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <input type="date" id="fechaHasta5" name="fechaHasta5" class="form-control" />
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div id="chkTodos" style="margin-top:5px">
                            <label class="col-md-2 letrasinformes">Todos</label>
                            <div class="col-md-3" style="width:150px;">
                                <input class="form-control small" type="checkbox" name="chkTodos" id="chkTodos" />
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div id="fechaDesembolso" style="margin-top:5px">
                            <label class="col-md-4 letrasinformes">Por fecha de desembolso</label>
                            <div class="col-md-3" style="width:150px;">
                                <input class="form-control small" type="checkbox" name="chkFechaDesembolso" id="chkFechaDesembolso" />
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div id="cuenta" style="margin-top:5px">
                            <label class="col-md-2 letrasinformes">Cuenta</label>
                            <div class="col-md-3" style="width:150px;">
                                @Html.DropDownList("Cuenta", (IEnumerable<SelectListItem>)ViewBag.cuentas, null, new { @class = "chosen-select-single", @id = "Cuenta", @name = "Cuenta" })
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div id="tipoInforme" style="margin-top:5px">
                            <label class="col-md-12 letrasinformes">Tipo de Informe</label>
                            <div class="col-md-12" style="width:150px;">
                                @Html.DropDownList("typeInforme", (IEnumerable<SelectListItem>)ViewBag.tipoInforme, null, new { @class = "form-control", @id = "typeInforme", @name = "typeInforme" })
                            </div>
                        </div>

                        <div class="clearfix"></div>
                        <div id="agencia" style="margin-top:5px">

                            <div class="col-md-3" style="width:150px;">
                                @Html.DropDownList("Agencia", (IEnumerable<SelectListItem>)ViewBag.agencias, null, new { @class = "chosen-select-single", @id = "Agencia", @name = "Agencia" })
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="clearfix"></div>
                                <div id="Nivel" style="margin-top:5px">

                                    <div class="col-md-3" style="width:150px;">
                                        @Html.DropDownList("nivel", (IEnumerable<SelectListItem>)ViewBag.nivel, null, new { @class = "form-control", @id = "nivel", @name = "nivel" })
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="clearfix"></div>
                                <div id="chkTerceros">
                                    <label class="col-md-3">Terceros</label>
                                    <div class="col-md-3">
                                        <input class="form-control" style="width:25px;height:25px" type="checkbox" name="chkTercero" id="chkTercero" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div id="costos" style="margin-top:5px">

                            <div class="col-md-3" style="width:150px;">
                                @Html.DropDownList("costo", (IEnumerable<SelectListItem>)ViewBag.costos, null, new { @class = "chosen-select-single", @id = "costo", @name = "costo" })
                            </div>
                        </div>

                        <div class="clearfix"></div>
                        <div id="tercero" style="margin-top:5px">
                            <label class="col-md-2 letrasinformes">Tercero</label>
                            @*<div class="col-md-3" style="width:150px;"><input type="text" name="Tercero" id="Tercero" class="form-control" /></div>*@
                            <div class="col-md-3" style="width:150px;">@Html.DropDownList("Tercero", (IEnumerable<SelectListItem>)ViewBag.terceros, null, new { @class = "chosen-select-single", @id = "Tercero", @name = "Tercero" })</div>
                        </div>
                    </div>

                    <div class="clearfix"></div>
                    <div class="modal-footer">
                        <a href="#" title="Imprimir"><i class="fa fa-print imprimirinforme" aria-hidden="true"></i></a>|
                        <button type="submit" style="background:none; padding:0px; border:none">
                            <i class="fa fa-file-excel-o excelinforme"></i>
                        </button>  |
                        @*<a href='@Url.Action("ExcelSaldos", "Informes")' title="Excel" onsubmit=""><i class="fa fa-file-excel-o excelinforme" aria-hidden="true"></i></a>|*@
                        <a href="#" title="Salir" data-dismiss="modal"><i class="fa fa-sign-out salirinforme" aria-hidden="true"></i></a>
                    </div>

                </div>
            </div>
        </div>
    </div>
}

@section scripts{

    <script src="~/Scripts/jquery-ui-1.12.0.min.js"></script>

    <script>
        $(document).ready(function () {
            $(".chosen-select-single").chosen();
            $(".chosen-select-multiple").chosen();
            $("#periodoTrimestral").append('<option value="' + "0" + '">' + "--Seleccione periodo--" + '</option>');
            getYears();
            fillMonths();

            function getYears() {
                $.ajax({
                    type: "GET",
                    url: "/Informes/Getyears",
                    dataType: "json",
                    success: function (data) {
                        $("#year2").append('<option value="' + "0" + '">' + "--Seleccione año--" + '</option>');
                        $.each(data.years, function (index, value) {
                            $("#year").append('<option value="' + value + '">' + value + '</option>');
                            $("#year2").append('<option value="' + value + '">' + value + '</option>');
                        });
                    }
                });
            }

            function fillMonths() {
                var months = "<option value='0'>Seleccione</option>"
                    + "<option value='1'>Enero</option>"
                    + "<option value='2'>Febrero</option>"
                    + "<option value='3'>Marzo</option>"
                    + "<option value='4'>Abril</option>"
                    + "<option value='5'>Mayo</option>"
                    + "<option value='6'>Junio</option>"
                    + "<option value='7'>Julio</option>"
                    + "<option value='8'>Agosto</option>"
                    + "<option value='9'>Septiembre</option>"
                    + "<option value='10'>Octubre</option>"
                    + "<option value='11'>Noviembre</option>"
                    + "<option value='12'>Diciembre</option>"

                $("#monthini").html(months);
                $("#monthfin").html(months);
                $("#mes2").html(months);
            }

            $('#librosaux').on('show.bs.modal', function (e) {
                var informe = $(e.relatedTarget).data('informe');

                if (informe == 34 || informe == 35) { // borrar todo el condicional IF si ya se completan todos los items
                    $("#title").html("CREDITOS Y CARTERA");
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Item no disponible!',

                    })
                } else {
                    var modal = $(this); // y sólo dejar esta línea
                }




                modal.find("#informe").val(informe);

                $("#cuenta").hide();
                //$("#tmini").hide();
                $("#chkTodos").hide();
                $("#fechaDesembolso").hide();
                $("#table1").hide();
                $("#table2").hide();
                $("#table3").hide();
                $("#agencia").hide();
                $("#table4").hide();
                $("#table5").hide();
                $("#tercero").hide();
                $("#chkTerceros").hide();
                $("#Nivel").hide();
                $("#costos").hide();
                $("#tipoInforme").hide();
                $("#selectPersonalDIV").hide();

                if (informe == 2) {
                    $("#title").html(" AUXILIAR POR CUENTA");
                    $("#cuenta").show();
                    $("#table2").show();


                }
                else {
                    $("#tercero").hide();
                    if (informe == 2) {
                        


                    } else if (informe == 1) {
                        $("#title").html("CRÉDITOS");
                        $("#fechaDesembolso").show();
                        $("#table2").show();


                    } else if (informe == 3) {
                        $("#title").html("Reportes de pagos diarios ");
                        
                        $("#table2").show();
                    } 
                    else if (informe == 4) {
                        $("#title").html("Reporte Cartera ");

                        
                    }
                    else if (informe == 5) {
                        $("#title").html("Reportes de pagos diarios ");
                        $("#table2").show();
                    }
                    else if (informe == 6) {
                        $("#title").html("Reportes de pagos x pagare");
                        $("#table2").show();
                    }

                }
            });

        });



        $("#librosaux").on('show.bs.modal', function (e) {
            $("#Cuenta").val('');
            $("#Tercero").val('');
        });

        $("#Cuent").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "/Informes/GetCuentas",
                    dataType: "json",
                    data: {
                        term: request.term, // search term
                    },
                    success: function (data) {
                        //response( data.results );
                        response($.map(data.results, function (item) {
                            return {

                                label: item.id + " - " + item.text,
                                value: item.id,

                            };
                        }));
                    }
                });
            },
            minLength: 1,
            select: function (event, ui) {
                /*$("#_nombre").val(ui.item.label);*/
            }
        });

        $("#nivel").change(function () {
            var nivel = $(this).val();
            if (nivel == "5") {
                $("#chkTerceros").show();
            } else {
                $("#chkTerceros").hide();
            }

        });

        $("#year2").change(function () {

            var anio = $(this).val();
            $("#periodoTrimestral").empty();

            if (anio != "0") {
                $.ajax({
                    url: '/Informes/getPeriodos',
                    datatype: "Json",
                    data: { anio: anio },//solo para enviar datos
                    type: 'post',
                }).done(function (data) {
                    if (data.status == true) {
                        var select = document.getElementById("periodoTrimestral");
                        var option = document.createElement("option");
                        option.value = "0";
                        option.text = "--Seleccione periodo--";
                        select.appendChild(option);
                        $.each(data.periodos, function (key, val) {
                            var option = document.createElement("option");
                            option.value = val[0];
                            option.text = val[1];
                            select.appendChild(option);
                        });//fin foreach
                    }
                    else if (data.status == false) {

                    }

                });//fin ajax
            } else {
                $("#periodoTrimestral").append('<option value="' + "0" + '">' + "--Seleccione periodo--" + '</option>');
            }


        });


        $("#Tercero").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "/Terceros/Terceros/GetTerceros4S2",
                    dataType: "json",
                    data: {
                        term: request.term, // search term
                    },
                    success: function (data) {
                        //response( data.results );
                        response($.map(data.results, function (item) {
                            return {

                                label: item.id + " - " + item.text,
                                value: item.id,

                            };
                        }));
                    }
                });
            },
            minLength: 1,
            select: function (event, ui) {
                /*$("#_nombre").val(ui.item.label);*/
            }
        });



    </script>

}

<!-- #region combosCuentas -->
<!-- #endregion -->
